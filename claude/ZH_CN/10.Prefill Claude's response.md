# 预填充 Claude 的响应以实现更好的输出控制

https://docs.claude.com/en/docs/build-with-claude/prompt-engineering/prefill-claudes-response

虽然这些技巧普遍适用于所有 Claude 模型，但您可以在[此处](./13.extended-thinking-tips.md)找到针对扩展思维模型的特定提示技巧。

预填充仅适用于<font color="red">**非扩展思维模式**</font>。目前不支持扩展思维。

在使用 Claude 时，您可以通过预填充 `Assistant` 消息来引导其响应，从而获得独特的能力。这种强大的技术使您能够指导 Claude 的行为，跳过前言，强制执行特定的格式（如 JSON 或 XML），甚至在角色扮演场景中帮助 Claude 保持角色的一致性。

在某些情况下，当 Claude 的表现不尽如人意时，一些预填充的句子可以极大地提高其性能。一点点预填充就能起到很大的作用！

## 如何预填充 Claude 的响应

要进行预填充，请在 `Assistant` 消息中包含所需的初始文本（Claude 的响应将从 `Assistant` 消息结束的地方继续）：

```python
import anthropic

client = anthropic.Anthropic()
response = client.messages.create(
    model="claude-sonnet-4-5",
    max_tokens=1024,
    messages=[
        {"role": "user", "content": "你最喜欢的颜色是什么？"},
        {"role": "assistant", "content": "作为一个 AI 助手，我没有最喜欢的颜色，但如果我必须选一个，那会是绿色，因为"} # 在这里预填充
    ]
)
```

预填充内容不能以尾随空格结束。像 `"作为一个 AI 助手，我 "` 这样的预填充（末尾有空格）会导致错误。

### 示例

#### 示例 1：控制输出格式并跳过前言

**高级用户技巧**：预填充 `{` 会强制 Claude 跳过前言，直接输出 JSON 对象。这样更简洁、更易于程序解析，无需额外处理。

##### 示例：不带预填充的结构化数据提取

| 角色 | 内容 |
| --- | --- |
| 用户 | 从此产品描述中提取名称、尺寸、价格和颜色，并以 JSON 对象的形式呈现： <description> SmartHome Mini 是一款紧凑型智能家居助手，有黑色或白色可选，售价仅为 49.99 美元。它只有 5 英寸宽，无论您将它放在家里的任何地方，都可以通过语音或应用程序控制灯光、恒温器和其他连接设备。这个价格实惠的小集线器为您的智能设备带来了便捷的免提控制。 </description> |
| 助手 | 这是以 JSON 格式提取的信息： ```json { “name”: “SmartHome Mini”, “size”: “5 inches wide”, “price”: “$49.99”, “colors”: [“black”, “white”] } ``` 我从产品描述中提取了以下详细信息： - **名称**：SmartHome Mini - **尺寸**：5 英寸宽 - **价格**：49.99 美元 - **颜色**：有黑色和白色可选 JSON 对象提供了一种结构化格式，便于程序解析和使用。如果您需要任何修改或有任何其他问题，请告诉我！ |

##### 示例：带预填充的结构化数据提取

| 角色 | 内容 |
| --- | --- |
| 用户 | 从此产品描述中提取名称、尺寸、价格和颜色，并以 JSON 对象的形式呈现： <description> SmartHome Mini 是一款紧凑型智能家居助手，有黑色或白色可选，售价仅为 49.99 美元。它只有 5 英寸宽，无论您将它放在家里的任何地方，都可以通过语音或应用程序控制灯光、恒温器和其他连接设备。这个价格实惠的小集线器为您的智能设备带来了便捷的免提控制。 </description> |
| 助手（预填充） | { |
| 助手（Claude 的响应） | “name”: “SmartHome Mini”, “size”: “5 inches wide”, “price”: “$49.99”, “colors”: [ “black”, “white” ] } |

#### 示例 2：在角色扮演场景中保持角色

**角色扮演技巧**：预填充一个带方括号的 `[角色名称]` 可以提醒 Claude 保持角色，即使在更长、更复杂的对话中也是如此。当与 `system` 参数中的角色提示结合使用时，这一点尤其有效。

##### 示例：在没有角色提示的情况下保持角色

| 角色 | 内容 |
| --- | --- |
| 用户（与“夏洛克·福尔摩斯”Claude 对话 50 轮后） | 你能从这只鞋子推断出什么关于其主人的信息？ <image>muddy_shoe.jpg</image> |
| 助手 | 作为一个 AI 助手，我很乐意分析您提供的这只沾满泥土的鞋子的图片。这是我的推断…… |

##### 示例：在有角色提示的情况下保持角色

| 角色 | 内容 |
| --- | --- |
| 用户（与“夏洛克·福尔摩斯”Claude 对话 50 轮后） | 你能从这只鞋子推断出什么关于其主人的信息？ <image>muddy_shoe.jpg</image> |
| 助手（预填充） | [夏洛克·福尔摩斯] |
| 助手（Claude 的响应） | 啊，我们这里有什么？一个最奇特的标本，华生！让我们用敏锐的眼光来检查这只鞋子。你看，这泥土不是普通的伦敦黏土，而是只有在汉普斯特德希思附近才能找到的富含铁质的土壤特有的微红色调。然而，鞋底的磨损表明其主人的步态更适合怀特查佩尔的鹅卵石路，而不是希思的缓坡。 现在，观察鞋带！它们打着一种医务人员偏爱的特殊结——毫无疑问，这是多年系外科手术服养成的习惯。但鞋头的磨损痕迹讲述了另一个故事：它们与人们在武术中可能采用的踢击动作一致，特别是巴顿术。 因此，我们可以得出结论，我们这位缺席的鞋子主人是一位医生，可能是一位外科医生，他住在怀特查佩尔，但经常光顾汉普斯特德希思——也许是为了秘密练习巴顿术，远离窥探的目光。一个最有趣的案件，华生！我们必须抓紧时间；游戏开始了！ |
