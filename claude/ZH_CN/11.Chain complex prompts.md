# 链接复杂提示以获得更强性能

https://docs.claude.com/en/docs/build-with-claude/prompt-engineering/chain-prompts

虽然这些技巧普遍适用于所有 Claude 模型，但您可以在[此处](./13.extended-thinking-tips.md)找到针对扩展思维模型的特定提示技巧。

在处理复杂任务时，如果您试图在单个提示中处理所有事情，Claude 有时可能会出错。思维链（CoT）提示很棒，但如果您的任务有多个不同的步骤，而每个步骤都需要深入思考，该怎么办呢？

进入提示链：将复杂任务分解为更小、更易于管理的子任务。

## 为什么要链接提示？

1. **准确性**：每个子任务都能得到 Claude 的全部注意力，从而减少错误。
2. **清晰度**：更简单的子任务意味着更清晰的指令和输出。
3. **可追溯性**：轻松查明并修复提示链中的问题。

***

## 何时链接提示

对于多步骤任务，如研究综合、文档分析或迭代式内容创建，请使用提示链。当任务涉及多个转换、引用或指令时，链接可以防止 Claude 遗漏或错误处理步骤。

**请记住：** 链条中的每个环节都能得到 Claude 的全部注意力！

**调试技巧**

如果 Claude 错过某个步骤或表现不佳，请将其隔离在自己的提示中。这样您就可以微调有问题的步骤，而无需重做整个任务。

***

## 如何链接提示

1. **确定子任务**：将您的任务分解为不同的、顺序的步骤。
2. **使用 XML 构建清晰的交接**：使用 XML 标签在提示之间传递输出。
3. **拥有单一任务目标**：每个子任务都应该有一个单一、明确的目标。
4. **迭代**：根据 Claude 的表现优化子任务。

### 示例链接工作流：

* **多步分析**：请参阅下面的法律和商业示例。
* **内容创建管道**：研究 → 大纲 → 草稿 → 编辑 → 格式化。
* **数据处理**：提取 → 转换 → 分析 → 可视化。
* **决策制定**：收集信息 → 列出选项 → 分析每个选项 → 推荐。
* **验证循环**：生成内容 → 审查 → 优化 → 再次审查。

**优化技巧**

对于具有独立子任务的任务（如分析多个文档），请创建单独的提示并并行运行它们以提高速度。

### 高级：自我修正链

您可以链接提示，让 Claude 审查自己的工作！这可以捕捉错误并优化输出，特别是对于高风险任务。

#### 示例：自我修正的研究摘要

**提示 1**

| 角色 | 内容 |
| --- | --- |
| 用户 | 总结这篇医学研究论文。 <paper>{{RESEARCH_PAPER}}</paper> 重点关注方法、发现和临床意义。 |
| 助手 {{SUMMARY}} | 方法：双盲随机对照试验（RCT），共 500 名 2 型糖尿病患者。A 组（n=250）接受新型 GLP-1/GIP 双重激动剂；B 组（n=250）接受标准 GLP-1 激动剂。为期 24 周的试验，主要终点为 HbA1c 降低。 发现： - A 组：HbA1c 平均降低 1.8% - B 组：HbA1c 平均降低 1.1% - A 组 68% vs. B 组 52% 的患者 HbA1c <7% - A 组：平均减重 5.2kg - B 组：平均减重 3.1kg 安全性：不良事件概况相似，无归因于治疗的严重事件。 临床意义：双重激动剂在血糖控制和减重方面优于标准疗法。可能成为一个改变游戏规则的药物，特别是对于肥胖的糖尿病患者。 |

**提示 2**

| 角色 | 内容 |
| --- | --- |
| 用户 | 您的任务是就一份研究论文摘要提供反馈。这是一份医学研究论文的摘要：<summary> {{SUMMARY}} </summary> 这是该研究论文：<paper> {{RESEARCH_PAPER}} </paper> 请以 A-F 的等级，审查此摘要的准确性、清晰度和完整性。 |
| 助手 {{FEEDBACK}} | 1. 准确性：A - 正确报告了关键统计数据：HbA1c 降低、减重。 - 准确指出了安全性概况和无严重不良事件。 - “改变游戏规则”的断言因显著更好的结果而合理。 2. 清晰度：A- - 简洁、结构良好，章节清晰。 - 善用比较性语言（例如，“比第一季度增长 3%”）提供上下文。 - 小问题：缩写如“RCT”、“GLP-1”和“GIP”未定义。考虑在首次使用时写出全称。 3. 完整性：B+ - 涵盖了所有要求的内容：方法、发现、临床意义。 - 缺失：各组的基线特征（它们是否匹配良好？）。 - 缺失：任何次要终点（例如，血压、血脂）。 - 考虑：长期影响或需要进一步研究。 总的来说，该摘要准确清晰，为快速了解研究提供了关键见解。要提升到 A+，请定义缩写，提及各组基线统计数据，注意任何次要结果，并简要提及需要长期研究。 |

**提示 3**

| 角色 | 内容 |
| --- | --- |
| 用户 | 您的任务是根据反馈改进一篇论文摘要。这是一份医学研究论文的初稿：<summary> {{SUMMARY}} </summary> 这是该研究论文：<paper> {{RESEARCH_PAPER}} </paper> 这是反馈：<feedback> {{FEEDBACK}} </feedback> 请根据反馈更新摘要。 |
| 助手 | 方法：双盲随机对照试验（RCT），共 500 名 2 型糖尿病患者。A 组（n=250）接受新型胰高血糖素样肽-1/葡萄糖依赖性促胰岛素多肽（GLP-1/GIP）双重激动剂；B 组（n=250）接受标准 GLP-1 激动剂。为期 24 周的试验的主要终点是 HbA1c 降低。各组在年龄、BMI 和基线 HbA1c 方面匹配良好。 发现： - A 组：HbA1c 平均降低 1.8% - B 组：HbA1c 平均降低 1.1% - A 组 68% vs. B 组 52% 的患者 HbA1c <7% - A 组：平均减重 5.2kg - B 组：平均减重 3.1kg 次要终点显示两组的血压和血脂水平均有改善，A 组结果略好。 安全性：不良事件概况相似，无归因于任一治疗的严重事件。 临床意义：双重 GLP-1/GIP 激动剂在血糖控制和减重方面优于标准 GLP-1 疗法。这些结果表明，它可能是一个重大的进步，特别是对于肥胖的糖尿病患者。然而，需要更长期的研究来证实其持续的疗效和安全性，并调查其对心血管结局的潜在益处。 |

***

## 示例

#### 示例：分析法律合同（不链接）

请注意，Claude 在其邮件草稿中遗漏了提供建议更改的指令。

| 角色 | 内容 |
| --- | --- |
| 用户 | 您是我们的首席法务官。请审查这份 SaaS 合同的风险，重点关注数据隐私、服务等级协议（SLA）和责任上限。 <contract> {{CONTRACT}} </contract> 然后起草一封邮件给供应商，说明您的担忧和建议的更改。 |
| 助手 | 在审查了 SaaS 合同后，我发现了几个问题： 1. 数据隐私（第 7 节）： - 问题：供应商有广泛的权利使用客户数据进行“服务改进”。 - 风险：可能导致未经授权的数据共享或货币化。 2. SLA（第 5 节）： - 问题：99.5% 的正常运行时间保证低于行业标准。 - 风险：过多的停机时间可能会影响我们的运营。 3. 责任（第 9 节）： - 问题：上限设定为 3 个月的费用。 - 风险：对于潜在的数据泄露或服务故障来说不足。 草稿邮件： 尊敬的 {{VENDOR}}， 在审查了 SaaS 协议后，我们有以下担忧： 1. 数据隐私：我们要求我们的数据仅用于直接提供服务，而不是宽泛的“服务改进”。请修改第 7 节。 2. SLA：99.5% 的正常运行时间是不够的。我们需要 99.99% 的正常运行时间，并明确规定惩罚措施。请修订第 5 节。 3. 责任：目前 3 个月费用的上限是不够的。我们建议上限为 12 个月的费用，对于数据泄露或故意不当行为不设上限。 我们重视我们潜在的合作伙伴关系，并相信这些更改将为我们的成功奠定基础。请发送一份修订后的协议。 顺祝商祺， {{CLO_NAME}} |

#### 示例：分析法律合同（链接）

**提示 1**

| 角色 | 内容 |
| --- | --- |
| 用户 | 您是我们的首席法务官。请审查这份 SaaS 合同的风险，重点关注数据隐私、服务等级协议（SLA）和责任上限。 <contract> {{CONTRACT}} </contract> 请在 `<risks>` 标签中输出您的发现。 |
| 助手 {{CONCERNS}} | 1. 数据隐私（第 7 节）： - 问题：供应商有广泛的权利使用客户数据进行“服务改进”。 - 风险：可能导致未经授权的数据共享或客户数据的货币化。 - 影响：可能导致客户信任的破坏，以及监管罚款（GDPR、CCPA）。 2. SLA（第 5 节）： - 问题：99.5% 的正常运行时间保证低于行业标准（通常为 99.99%）。 - 风险：每年长达 43.8 小时的停机时间，而 99.99% 的情况下为 52.6 分钟。 - 影响：运营中断、收入损失、客户不满意。 3. 责任（第 9 节）： - 问题：责任上限设定为 3 个月的费用。 - 风险：对于潜在的数据泄露、知识产权盗窃或长时间的服务故障来说不足。 - 影响：对于可能远远超过上限的损害（如集体诉讼或监管罚款）的赔偿不足。 |

**提示 2**

| 角色 | 内容 |
| --- | --- |
| 用户 | 起草一封邮件给 SaaS 产品供应商，概述以下担忧并提出更改建议。这是担忧内容：<concerns> {{CONCERNS}} </concerns> |
| 助手 {{EMAIL}} | 尊敬的 {{VENDOR}}， 在对拟议的 SaaS 协议进行彻底审查后，我们的法律团队发现了一些必须在继续之前解决的高优先级问题： 1. 数据隐私（第 7 节）： - 当前：广泛的权利使用客户数据进行“服务改进”。 - 担忧：潜在的未经授权的数据共享或货币化。 - 建议更改：将数据使用限制为直接提供服务。任何用于改进、分析或营销的用途都必须是可选的、可撤销的和匿名的。 2. SLA（第 5 节）： - 当前：99.5% 的正常运行时间保证。 - 担忧：每年长达 43.8 小时的停机时间，有运营中断的风险。 - 建议更改：99.99% 的正常运行时间，并提供分级服务抵扣。例如，<99.99% 抵扣 10%，<99.9% 抵扣 25%，<99.5% 抵扣 50%。 3. 责任（第 9 节）： - 当前：上限为 3 个月的费用。 - 担忧：对于数据泄露、知识产权盗窃或长时间的中断来说严重不足。 - 建议更改：一般责任上限为 12 个月的费用。对于数据泄露、故意不当行为、知识产权侵权不设上限。 这些更改对我们来说是不可协商的。它们符合行业标准以及我们对数据安全、卓越运营和信托责任的承诺。我们重视我们合作伙伴关系的潜力，解决这些问题将为我们奠定坚实的基础。 请让您的法律团队审查并采纳这些更改。我们很乐意进一步讨论，以确保相互理解和达成一致。 顺祝商祺， {{CLO_NAME}} |

**提示 3**

| 角色 | 内容 |
| --- | --- |
| 用户 | 您的任务是审查一封电子邮件并提供反馈。这是该电子邮件：<email> {{EMAIL}} </email> 请就语气、清晰度和专业性提供反馈。 |
| 助手 | 1. 语气： - 专业且果断，但不具对抗性。 - 使用“不可协商”一词很强硬，但鉴于问题的严重性是合理的。 - 协作性语言（“我们重视”、“乐于讨论”）平衡了强硬态度，保持了建设性的基调。 2. 清晰度： - 结构出色：每个问题都说明了现状、担忧和建议的更改。 - 技术术语（例如，“EBITDA”、“分级服务抵扣”）在 B2B SaaS 的上下文中是恰当的。 - 行动项目明确：供应商的法律团队审查并采纳更改。 3. 专业性： - 关注互利和行业标准，而不仅仅是我们的要求。 - 提及更广泛的责任（数据安全、卓越运营、信托责任），提升了讨论的层次。 - 提供进一步讨论，表明致力于理解和解决问题。 总的来说，这封电子邮件在果断和协作之间取得了恰当的平衡。它清晰地阐述了我们的担忧，提出了具体的解决方案，并保持了专业、以合作伙伴为导向的基调。无需修改；可以发送。 |

#### 示例：多租户策略审查

**提示 1**

| 角色 | 内容 |
| --- | --- |
| 用户 | 作为一名高级解决方案架构师，请审查并分析我们新企业 SaaS 产品的此多租户策略。 <strategy> {{STRATEGY}} </strategy> 重点关注可扩展性、安全性和成本效益。 |
| 助手 {{ANALYSIS}} | 1. 可扩展性： + 按租户进行数据库分片可减少争用，支持高增长。 + 微服务允许组件独立扩展。 - 共享应用服务器在极端负载下可能会成为瓶颈。 - 未提及应用层的自动扩展或负载均衡。 2. 安全性： + 通过分片实现租户数据隔离，可减轻数据泄露的风险。 + 具有短有效期和刷新令牌的 JWT 是行业最佳实践。 - 未提及加密（静态、传输中）或密钥管理。 - IAM 策略缺乏关于角色、权限或 RBAC 的详细信息。 3. 成本效益： + 共享应用服务器可降低空闲资源成本。 + 用于不频繁任务的无服务器功能可优化成本。 - 与优化的多租户数据库相比，每个租户一个数据库在规模化时可能会增加成本。 - 未讨论用于节约成本的预留实例或竞价实例。 |

**提示 2**

| 角色 | 内容 |
| --- | --- |
| 用户 | 根据对多租户策略的此分析，为工程领导层起草一份策略审查文件。 <strategy> {{STRATEGY}} </strategy> <analysis> {{ANALYSIS}} </analysis> 包括执行摘要、详细分析和建议。 |
| 助手 {{STRATEGY_DOC}} | # 多租户策略审查：SaaS 企业产品 ## 执行摘要 拟议的策略在可扩展性和安全性原则方面展示了坚实的基础，但在实施细节上存在差距。它在数据隔离和组件级扩展方面表现出色，但缺乏强大的应用层扩展和高级安全措施。成本优化是存在的，但在大规模时可能会失效。通过有针对性的增强，该策略可以有效地支持我们的企业 SaaS 抱负。 ## 详细分析 ### 1. 可扩展性：B+ 优点： - 按租户进行数据库分片非常出色。它最大限度地减少了查询延迟，支持高数据增长，并促进了无缝的按租户扩展。 - 微服务架构允许根据需求扩展单个组件，这对于处理多样化的企业工作负载至关重要。 缺点： - 共享应用服务器有成为瓶颈的风险。随着租户数量和流量的增长，这些可能会降低所有租户的性能。 - 应用层缺乏自动扩展和负载均衡是一个严重的疏忽。这些对于在不过度配置的情况下处理流量高峰至关重要。 ### 2. 安全性：B- 优点： - 分片数据库提供了强大的租户数据隔离，减轻了租户之间数据泄露或未经授权访问的风险。 - 具有短有效期和刷新令牌的 JWT 符合 OWASP 最佳实践，减少了令牌漏洞窗口。 缺点： - 未提及静态或传输中的数据加密（TLS 1.3）。这对于企业数据是不可协商的。 - 密钥管理策略缺失。加密密钥、JWT 密钥和数据库凭证是如何管理和轮换的？ - IAM 深度不足。我们需要具有明确定义的角色的 RBAC、用于细粒度权限的基于属性的访问控制（ABAC），以及与企业身份提供商（SAML、OIDC）的集成。 ### 3. 成本效益：B 优点： - 共享应用服务器降低了空闲容量成本，适合稳定状态的流量。 - 用于不频繁任务（例如，报告）的无服务器是明智的；仅在这些资源被使用时付费。 缺点： - 与设计良好的、具有强大数据分区的多租户数据库相比，每个租户一个数据库在规模化时可能不具成本效益。 - 未提及用于节约成本的措施，如用于可预测工作负载的预留实例或用于容错任务的竞价实例。 - 应用层缺乏自动扩展可能导致过度配置，从而增加成本。 ## 建议 1. **应用层弹性**：使用 Kubernetes 或云原生服务（EKS、GKE）实现自动扩展。跨可用区部署，并为静态资产部署 CDN。 2. **安全加固**： a. 加密静态数据（AES-256）和传输中数据（TLS 1.3）。 b. 使用托管 KMS（AWS KMS、GCP KMS）进行密钥管理。 c. 使用 RBAC、ABAC 和 SAML/OIDC 增强 IAM，以实现企业 SSO。 3. **成本优化**： a. 评估列式多租户数据库（例如，Snowflake）与大规模分片的比较。 b. 对应用服务器使用预留实例，对非关键工作负载使用竞价实例。 c. 实施主动监控和适当调整，以避免过度配置。 4. **概念验证（PoC）**：在全面实施之前，进行大规模模拟的 PoC： a. 测试分片数据库与优化的多租户数据库的成本和性能。 b. 使用模拟的企业级流量高峰对应用层进行压力测试。 c. 进行第三方安全审计，重点关注数据隔离和访问控制。 通过这些增强，我们的多租户策略将达到企业级：可扩展、安全且具有成本效益。PoC 将验证我们的设计选择，并增强我们企业客户的信心。 |

**提示 3**

| 角色 | 内容 |
| --- | --- |
| 用户 | 请对这份策略审查文件的清晰度、可操作性以及与企业优先事项的一致性进行评分。 <priorities> {{PRIORITIES}} </priorities> <strategy_doc> {{STRATEGY_DOC}} </strategy_doc> |
| 助手 | 1. 清晰度：A + 结构清晰，包含执行摘要、详细分析和建议。 + 分析使用评分系统（B+、B-），以便快速了解优缺点。 + 技术术语（RBAC、ABAC、TLS）进行了解释或 contextualized，有助于非技术领导层理解。 + 视觉辅助工具（项目符号、缩进）增强了可读性。 2. 可操作性：A- + 建议具体且技术性强（例如，“使用 Kubernetes 实现自动扩展”）。 + 具有明确目标的 PoC 计划提供了路线图。 + 缺失：每个建议的时间表、资源需求或团队分配。 + 考虑：添加一个“后续步骤”部分，其中包含立即行动、角色和高层次的时间表。 3. 企业一致性：A+ + 直接解决了企业优先事项： - 可扩展性：讨论了处理企业级流量高峰。 - 安全性：重点关注数据隔离、加密和企业 IAM。 - 成本：策略与企业 FinOps（预留实例、适当调整）保持一致。 + 具有“大规模模拟”和安全审计的 PoC 表明了对企业级质量的承诺。 + 语言与企业关注点产生共鸣：“不可接受的风险”、“企业级”、“增强信心”。 总的来说，该文件在清晰度和企业一致性方面表现出色。可操作性很强，但可以通过添加“后续步骤”部分提升至 A+。技术深度与清晰的解释相结合，使其对于技术和非技术领导层都非常有效。干得好！ |
