# 扩展思维技巧

https://docs.claude.com/en/docs/build-with-claude/prompt-engineering/long-context-tips

本指南提供了充分利用 Claude 扩展思维功能的高级策略和技巧。扩展思维允许 Claude 逐步解决复杂问题，从而提高在困难任务上的表现。

有关何时使用扩展思维的指导，请参阅[扩展思维模型](https://docs.claude.com/en/docs/build-with-claude/extended-thinking)。

## 深入探讨之前

本指南假定您已经决定使用扩展思维模式，并已查阅我们的基本步骤[如何开始使用扩展思维](https://docs.claude.com/en/docs/build-with-claude/extended-thinking#getting-started-with-extended-thinking-models)以及我们的[扩展思维实施指南](https://docs.claude.com/en/docs/build-with-claude/extended-thinking)。

### 扩展思维的技术注意事项

* 思维 token 的最小预算为 1024 个 token。我们建议您从最小的思维预算开始，然后根据您的需求和任务复杂性逐步增加。
* 对于最佳思维预算超过 32K 的工作负载，我们建议您使用[批处理](https://docs.claude.com/en/docs/build-with-claude/batch-processing)以避免网络问题。要求模型思考超过 32K token 的请求会导致长时间运行的请求，可能会遇到系统超时和开放连接限制。
* 扩展思维在英语中表现最佳，但最终输出可以是[Claude 支持的任何语言](https://docs.claude.com/en/docs/build-with-claude/multilingual-support)。
* 如果您需要的思维低于最小预算，我们建议您使用标准模式，关闭思维功能，并使用传统的带有 XML 标签（如 `<thinking>`）的思维链提示。请参阅[思维链提示](./07.Let Claude think.md)。

## 扩展思维的提示技巧

### 首先使用通用指令，然后使用更具体的逐步指令进行故障排除

Claude 通常在使用高级指令（即让其深入思考任务）时表现更好，而不是使用逐步的规定性指导。模型在解决问题方面的创造力可能超过人类规定最佳思维过程的能力。

例如，不要这样：

  ```text 用户
  请一步一步地思考这个数学问题：
  1. 首先，确定变量
  2. 然后，建立方程
  3. 接下来，求解 x
  ...
  ```
可以这样：

  ```text 用户
  请彻底、详细地思考这个数学问题。
  考虑多种方法并展示您的完整推理过程。
  如果您的第一种方法不起作用，请尝试其他方法。
  ```

也就是说，在需要时，Claude 仍然可以有效地遵循复杂的结构化执行步骤。该模型可以处理比以前版本更长、更复杂的指令列表。我们建议您从更通用的指令开始，然后阅读 Claude 的思维输出，并在此基础上进行迭代，以提供更具体的指令来引导其思维。

### 带有扩展思维的多样本提示

[多样本提示](./06.Use examples (multishot prompting) .md)与扩展思维配合得很好。当您向 Claude 提供如何思考问题的示例时，它将在其扩展思维块中遵循类似的推理模式。

您可以在扩展思维场景中，通过使用像 `<thinking>` 或 `<scratchpad>` 这样的 XML 标签，在提示中包含少量示例，以在这些示例中指示扩展思维的规范模式。

Claude 会将该模式推广到正式的扩展思维过程中。但是，让 Claude 自由地以其认为最佳的方式进行思考，可能会得到更好的结果。

示例：

  ```text 用户
  我将向您展示如何解决一个数学问题，然后我希望您解决一个类似的问题。

  问题 1：80 的 15% 是多少？

  <thinking>
  要计算 80 的 15%：
  1. 将 15% 转换为小数：15% = 0.15
  2. 相乘：0.15 × 80 = 12
  </thinking>

  答案是 12。

  现在解决这个问题：
  问题 2：240 的 35% 是多少？
  ```

### 通过扩展思维最大化指令遵循

启用扩展思维后，Claude 的指令遵循能力显著提高。该模型通常会：

1. 在扩展思维块内对指令进行推理
2. 在响应中执行这些指令

要最大化指令遵循：

* 清晰、具体地说明您想要什么
* 对于复杂的指令，可以考虑将其分解为编号的步骤，让 Claude 按部就班地完成
* 允许 Claude 在其扩展思维中有足够的预算来完全处理指令

### 使用扩展思维来调试和引导 Claude 的行为

您可以使用 Claude 的思维输出来调试其逻辑，尽管这种方法并非总是完全可靠。

为了最好地利用这种方法，我们建议您遵循以下技巧：

* 我们不建议将 Claude 的扩展思维重新传递到用户文本块中，因为这不会提高性能，实际上可能会降低结果。
* 明确禁止预填充扩展思维，手动更改模型在其思维块之后输出的文本可能会因模型混淆而降低结果。

当关闭扩展思维时，仍然允许标准的 `assistant` 响应文本[预填充](./10.Prefill Claude's response.md)。

有时 Claude 可能会在助手输出文本中重复其扩展思维。如果您想要一个干净的响应，请指示 Claude 不要重复其扩展思维，只输出答案。

### 充分利用长输出和长篇思维

对于数据集生成用例，可以尝试使用诸如“请创建一个极其详细的...表格”之类的提示来生成全面的数据集。

对于诸如详细内容生成之类的用例，您可能希望生成更长的扩展思维块和更详细的响应，请尝试以下技巧：

* 同时增加最大扩展思维长度和明确要求更长的输出
* 对于非常长的输出（20,000+ 字），请请求一个详细的大纲，其中包含精确到段落级别的字数统计。然后要求 Claude 将其段落与大纲进行索引，并保持指定的字数。


我们不建议您为了输出更多 token 而强迫 Claude 输出更多 token。相反，我们鼓励您从一个较小的思维预算开始，并根据需要增加，以找到适合您用例的最佳设置。

以下是 Claude 因更长的扩展思维而表现出色的示例用例：

#### 复杂的 STEM 问题

复杂的 STEM 问题要求 Claude 建立心智模型，应用专业知识，并按顺序完成逻辑步骤——这些过程都受益于更长的推理时间。

**标准提示**

```markdown
编写一个 python 脚本，用于一个在正方形内弹跳的黄色小球，
请确保正确处理碰撞检测。
让正方形缓慢旋转。
```

**增强提示**

```markdown
编写一个 Python 脚本，用于一个在超正方体内弹跳的黄色小球，
确保正确处理碰撞检测。
让超正方体缓慢旋转。
确保小球保持在超正方体内。
```

#### 约束优化问题

约束优化挑战 Claude 同时满足多个相互竞争的要求，这最好通过允许长时间的扩展思维来实现，以便模型可以系统地解决每个约束。

**标准提示**

```markdown
计划一次为期一周的日本假期。
```

**增强提示**

```markdown
计划一次为期 7 天的日本之旅，需满足以下限制条件：
- 预算为 2,500 美元
- 必须包括东京和京都
- 需要适应素食饮食
- 偏爱文化体验而非购物
- 必须包括一天的徒步旅行
- 每天地点之间的旅行时间不超过 2 小时
- 每天下午需要有空闲时间给家里打电话
- 尽可能避开人群
```

#### 思维框架

结构化的思维框架为 Claude 提供了明确的方法论，当 Claude 被给予较长的扩展思维空间来遵循每个步骤时，这可能会最有效。

**标准提示**

```markdown
为微软在 2027 年前进入个性化医疗市场制定一项全面的战略。
```

**增强提示**

```markdown
为微软在 2027 年前进入个性化医疗市场制定一项全面的战略。

首先：
1. 绘制一份蓝海战略画布
2. 应用波特五力模型来识别竞争压力

接下来，根据监管和技术变量，进行一次包含四个不同未来的情景规划练习。

对于每个情景：
- 使用安索夫矩阵制定战略应对措施

最后，应用三个地平线框架来：
- 绘制过渡路径
- 识别每个阶段潜在的颠覆性创新
```

### 让 Claude 反思并检查其工作，以提高一致性和错误处理能力

您可以使用简单的自然语言提示来提高一致性并减少错误：

1. 要求 Claude 在宣布任务完成前用一个简单的测试来验证其工作
2. 指示模型分析其上一步是否达到了预期结果
3. 对于编码任务，要求 Claude 在其扩展思维中运行测试用例

示例：

  ```text 用户
  编写一个函数来计算一个数的阶乘。
  在完成之前，请用以下测试用例验证您的解决方案：
  - n=0
  - n=1
  - n=5
  - n=10
  并修复您发现的任何问题。
  ```
